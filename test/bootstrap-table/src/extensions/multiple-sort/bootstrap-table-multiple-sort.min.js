(function(d){var a=false;var e=function(k){var f=k.sortModalSelector,j="#"+f;if(!d(j).hasClass("modal")){var l='  <div class="modal fade" id="'+f+'" tabindex="-1" role="dialog" aria-labelledby="'+f+'Label" aria-hidden="true">';l+='         <div class="modal-dialog">';l+='             <div class="modal-content">';l+='                 <div class="modal-header">';l+='                     <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>';l+='                     <h4 class="modal-title" id="'+f+'Label">'+k.options.formatMultipleSort()+"</h4>";l+="                 </div>";l+='                 <div class="modal-body">';l+='                     <div class="bootstrap-table">';l+='                         <div class="fixed-table-toolbar">';l+='                             <div class="bars">';l+='                                 <div id="toolbar">';l+='                                     <button id="add" type="button" class="btn btn-default"><i class="'+k.options.iconsPrefix+" "+k.options.icons.plus+'"></i> '+k.options.formatAddLevel()+"</button>";l+='                                     <button id="delete" type="button" class="btn btn-default" disabled><i class="'+k.options.iconsPrefix+" "+k.options.icons.minus+'"></i> '+k.options.formatDeleteLevel()+"</button>";l+="                                 </div>";l+="                             </div>";l+="                         </div>";l+='                         <div class="fixed-table-container">';l+='                             <table id="multi-sort" class="table">';l+="                                 <thead>";l+="                                     <tr>";l+="                                         <th></th>";l+='                                         <th><div class="th-inner">'+k.options.formatColumn()+"</div></th>";l+='                                         <th><div class="th-inner">'+k.options.formatOrder()+"</div></th>";l+="                                     </tr>";l+="                                 </thead>";l+="                                 <tbody></tbody>";l+="                             </table>";l+="                         </div>";l+="                     </div>";l+="                 </div>";l+='                 <div class="modal-footer">';l+='                     <button type="button" class="btn btn-default" data-dismiss="modal">'+k.options.formatCancel()+"</button>";l+='                     <button type="button" class="btn btn-primary">'+k.options.formatSort()+"</button>";l+="                 </div>";l+="             </div>";l+="         </div>";l+="     </div>";d("body").append(d(l));k.$sortModal=d(j);var g=k.$sortModal.find("tbody > tr");k.$sortModal.off("click","#add").on("click","#add",function(){var i=k.$sortModal.find(".multi-sort-name:first option").length,m=k.$sortModal.find("tbody tr").length;if(m<i){m++;k.addLevel();k.setButtonStates()}});k.$sortModal.off("click","#delete").on("click","#delete",function(){var i=k.$sortModal.find(".multi-sort-name:first option").length,m=k.$sortModal.find("tbody tr").length;if(m>1&&m<=i){m--;k.$sortModal.find("tbody tr:last").remove();k.setButtonStates()}});k.$sortModal.off("click",".btn-primary").on("click",".btn-primary",function(){var n=k.$sortModal.find("tbody > tr"),r=k.$sortModal.find("div.alert"),m=[],q=[];k.options.sortPriority=d.map(n,function(v){var t=d(v),u=t.find(".multi-sort-name").val(),i=t.find(".multi-sort-order").val();m.push(u);return{sortName:u,sortOrder:i}});var s=m.sort();for(var p=0;p<m.length-1;p++){if(s[p+1]==s[p]){q.push(s[p])}}if(q.length>0){if(r.length===0){r='<div class="alert alert-danger" role="alert"><strong>'+k.options.formatDuplicateAlertTitle()+"</strong> "+k.options.formatDuplicateAlertDescription()+"</div>";d(r).insertBefore(k.$sortModal.find(".bars"))}}else{if(r.length===1){d(r).remove()}k.$sortModal.modal("hide");k.options.sortName="";if(k.options.sidePagination==="server"){var o=k.options.queryParams;k.options.queryParams=function(i){i.multiSort=k.options.sortPriority;return o(i)};a=false;k.initServer(k.options.silentSort);return}k.onMultipleSort()}});if(k.options.sortPriority===null||k.options.sortPriority.length===0){if(k.options.sortName){k.options.sortPriority=[{sortName:k.options.sortName,sortOrder:k.options.sortOrder}]}}if(k.options.sortPriority!==null&&k.options.sortPriority.length>0){if(g.length<k.options.sortPriority.length&&typeof k.options.sortPriority==="object"){for(var h=0;h<k.options.sortPriority.length;h++){k.addLevel(h,k.options.sortPriority[h])}}}else{k.addLevel(0)}k.setButtonStates()}};d.fn.bootstrapTable.methods.push("multipleSort");d.extend(d.fn.bootstrapTable.defaults,{showMultiSort:false,showMultiSortButton:true,sortPriority:null,onMultipleSort:function(){return false}});d.extend(d.fn.bootstrapTable.defaults.icons,{sort:"glyphicon-sort",plus:"glyphicon-plus",minus:"glyphicon-minus"});d.extend(d.fn.bootstrapTable.Constructor.EVENTS,{"multiple-sort.bs.table":"onMultipleSort"});d.extend(d.fn.bootstrapTable.locales,{formatMultipleSort:function(){return"Multiple Sort"},formatAddLevel:function(){return"Add Level"},formatDeleteLevel:function(){return"Delete Level"},formatColumn:function(){return"Column"},formatOrder:function(){return"Order"},formatSortBy:function(){return"Sort by"},formatThenBy:function(){return"Then by"},formatSort:function(){return"Sort"},formatCancel:function(){return"Cancel"},formatDuplicateAlertTitle:function(){return"Duplicate(s) detected!"},formatDuplicateAlertDescription:function(){return"Please remove or change any duplicate column."},formatSortOrders:function(){return{asc:"Ascending",desc:"Descending"}}});d.extend(d.fn.bootstrapTable.defaults,d.fn.bootstrapTable.locales);var b=d.fn.bootstrapTable.Constructor,c=b.prototype.initToolbar;b.prototype.initToolbar=function(){this.showToolbar=true;var i=this,f="sortModal_"+this.$el.attr("id"),k="#"+f;this.$sortModal=d(k);this.sortModalSelector=f;c.apply(this,Array.prototype.slice.apply(arguments));if(i.options.sidePagination==="server"&&!a&&i.options.sortPriority!==null){var g=i.options.queryParams;i.options.queryParams=function(l){l.multiSort=i.options.sortPriority;return g(l)}}if(this.options.showMultiSort){var j=this.$toolbar.find(">.btn-group").first(),h=this.$toolbar.find("div.multi-sort");if(!h.length&&this.options.showMultiSortButton){h='  <button class="multi-sort btn btn-default'+(this.options.iconSize===undefined?"":" btn-"+this.options.iconSize)+'" type="button" data-toggle="modal" data-target="'+k+'" title="'+this.options.formatMultipleSort()+'">';h+='     <i class="'+this.options.iconsPrefix+" "+this.options.icons.sort+'"></i>';h+="</button>";j.append(h);e(i)}this.$el.on("sort.bs.table",function(){a=true});this.$el.on("multiple-sort.bs.table",function(){a=false});this.$el.on("load-success.bs.table",function(){if(!a&&i.options.sortPriority!==null&&typeof i.options.sortPriority==="object"&&i.options.sidePagination!=="server"){i.onMultipleSort()}});this.$el.on("column-switch.bs.table",function(n,m){for(var l=0;l<i.options.sortPriority.length;l++){if(i.options.sortPriority[l].sortName===m){i.options.sortPriority.splice(l,1)}}i.assignSortableArrows();i.$sortModal.remove();e(i)});this.$el.on("reset-view.bs.table",function(){if(!a&&i.options.sortPriority!==null&&typeof i.options.sortPriority==="object"){i.assignSortableArrows()}})}};b.prototype.multipleSort=function(){var f=this;if(!a&&f.options.sortPriority!==null&&typeof f.options.sortPriority==="object"&&f.options.sidePagination!=="server"){f.onMultipleSort()}};b.prototype.onMultipleSort=function(){var g=this;var f=function(i,j){return i>j?1:i<j?-1:0};var h=function(l,k){var n=[],m=[];for(var o=0;o<g.options.sortPriority.length;o++){var j=g.options.sortPriority[o].sortOrder==="desc"?-1:1,p=l[g.options.sortPriority[o].sortName],q=k[g.options.sortPriority[o].sortName];if(p===undefined||p===null){p=""}if(q===undefined||q===null){q=""}if(d.isNumeric(p)&&d.isNumeric(q)){p=parseFloat(p);q=parseFloat(q)}if(typeof p!=="string"){p=p.toString()}n.push(j*f(p,q));m.push(j*f(q,p))}return f(n,m)};this.data.sort(function(j,i){return h(j,i)});this.initBody();this.assignSortableArrows();this.trigger("multiple-sort")};b.prototype.addLevel=function(g,h){var j=g===0?this.options.formatSortBy():this.options.formatThenBy();this.$sortModal.find("tbody").append(d("<tr>").append(d("<td>").text(j)).append(d("<td>").append(d('<select class="form-control multi-sort-name">'))).append(d("<td>").append(d('<select class="form-control multi-sort-order">'))));var i=this.$sortModal.find(".multi-sort-name").last(),f=this.$sortModal.find(".multi-sort-order").last();d.each(this.columns,function(k,l){if(l.sortable===false||l.visible===false){return true}i.append('<option value="'+l.field+'">'+l.title+"</option>")});d.each(this.options.formatSortOrders(),function(l,k){f.append('<option value="'+l+'">'+k+"</option>")});if(h!==undefined){i.find('option[value="'+h.sortName+'"]').attr("selected",true);f.find('option[value="'+h.sortOrder+'"]').attr("selected",true)}};b.prototype.assignSortableArrows=function(){var g=this,h=g.$header.find("th");for(var f=0;f<h.length;f++){for(var j=0;j<g.options.sortPriority.length;j++){if(d(h[f]).data("field")===g.options.sortPriority[j].sortName){d(h[f]).find(".sortable").removeClass("desc asc").addClass(g.options.sortPriority[j].sortOrder)}}}};b.prototype.setButtonStates=function(){var f=this.$sortModal.find(".multi-sort-name:first option").length,g=this.$sortModal.find("tbody tr").length;if(g==f){this.$sortModal.find("#add").attr("disabled","disabled")}if(g>1){this.$sortModal.find("#delete").removeAttr("disabled")}if(g<f){this.$sortModal.find("#add").removeAttr("disabled")}if(g==1){this.$sortModal.find("#delete").attr("disabled","disabled")}}})(jQuery);