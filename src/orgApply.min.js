var citydata=[];var cityId,provinceId,type;var bannerImg;var Authorization=$.cookie("Authorization");cityData2=cityData.slice(0,31);cityData2.push(cityData[32]);cityData2.push(cityData[33]);cityData2.push(cityData[31]);console.log(cityData2,"citydata2222");cityData=cityData2;getProvince();function getProvince(){var a=JSON.stringify({level:0,parentId:0});$.ajax({url:"http://120.27.226.156:8080/roo-mobile-web/cnarea/read/list",type:"put",contentType:"application/json;charset=utf-8",data:a,success:function(c){console.log(c,"获取省份");console.log(cityData,"cityData插件");$.each(c.data,function(d,e){cityData[d].value=e.id;cityData[d].text=e.mergerName;delete cityData[d].children;citydata[d]={text:e.mergerName,children:[]};citydata.push(citydata[d]);b(e.id,d)});function b(h,d){var e=d;var g=citydata[e].children;var f=JSON.stringify({level:1,parentId:h});$.ajax({url:"http://120.27.226.156:8080/roo-mobile-web/cnarea/read/list",type:"PUT",contentType:"application/json;charset=utf-8",data:f,success:function(j){$.each(j.data,function(k,l){g[k]={value:l.id,text:l.name};g.push(g[k])});cityData[e].children=g}})}}})}(function(a,b){a.init();a.ready(function(){var g=function(k,l){return k[l]||""};var f=new a.PopPicker();f.setData([{value:"1",text:"鉴定"},{value:"2",text:"典当"},{value:"3",text:"拍卖"},{value:"4",text:"协会"},{value:"5",text:"展览"},{value:"6",text:"学校"},{value:"7",text:"博物馆"}]);var j=b.getElementById("showTypePicker");var d=b.getElementById("typeResult");j.addEventListener("tap",function(k){f.show(function(l){d.innerText=l[0].text;type=l[0].value})},false);var c=new a.PopPicker({layer:2});c.setData(cityData);var e=b.getElementById("showCityPicker");var h=b.getElementById("cityResult");e.addEventListener("tap",function(k){c.show(function(l){h.innerText=l[0].text+" "+l[1].text;console.log(l[0].value,l[0].text,"item0");console.log(l[1].value,l[1].text,"item1");provinceId=l[0].value;cityId=l[1].value})},false)})})(mui,document);$(function(){mui.init({});var c=document.getElementsByClassName("prompt-btn");var a=document.getElementsByClassName("my-info");var b=document.getElementsByClassName("inp-type");console.log(a,c);for(i=0;i<c.length;i++){c[i].index=i;c[i].addEventListener("tap",function(h){var j=this;h.detail.gesture.preventDefault();var f=b[this.index].innerText;var g="请填写"+f;console.log(g);var d=["取消","确定"];mui.prompt(g,"","",d,function(k){if(k.index===1){a[j.index].innerText=k.value}});if(this.index===3){$(".mui-popup-input input").attr("type","tel")}$(".mui-popup-title").remove()})}});$(function(){var b=document.querySelector("input");if(a()){b.removeAttribute("capture")}function a(){var c=navigator.userAgent.toLowerCase();if(c.match(/iPhone\sOS/i)=="iphone os"){return true}else{return false}}$("#app-camera").on("tap",function(){$("#app-upload-img").click();function c(e){if(e.files&&e.files[0]){console.log(e.files[0],"照片file");var d=new FileReader();d.onload=function(h){$("#blah").attr("src",h.target.result)};d.readAsDataURL(e.files[0])}var g=e.files[0];var f=new FormData();f.append("file",g);$.ajax({type:"post",url:"http://120.27.226.156:8080/roo-mobile-web/image",contentType:false,processData:false,file:g,dataType:"JSON",data:f,success:function(h){console.log(h,"主图信息");bannerImg=h.data[0].thumbnailUrl}})}$("#app-upload-img").change(function(){c(this)})})});$(function(){$(".app-submit").on("tap",function(){if($(".orgName").text()==""){mui.toast("机构名称不能为空！");return}if($(".orgCode").text()==""){mui.toast("组织代码不能为空！");return}if($("#typeResult").text()==""){mui.toast("所属类型不能为空！");return}if($("#cityResult").text()==""){mui.toast("所在地区不能为空！");return}parameters=JSON.stringify({name:$(".orgName").text(),cityId:cityId,provinceId:provinceId,code:$(".orgCode").text(),type:type,bannerImg:bannerImg,contacts:$("#contacts").text(),phone:$("#phone").text(),shopAddress:$("#detail-address").val(),remark:$("#remark").val()});console.log(parameters,"机构信息222");$.ajax({url:"http://120.27.226.156:8080/roo-mobile-web/organ/",beforeSend:function(a){a.setRequestHeader("Authorization",Authorization)},type:"post",contentType:"application/json;charset=utf-8",data:parameters,success:function(a){if(a.httpCode==200){location.href="./jigou-detail.html"}else{alert("提交失败"+a.msg)}}})})});